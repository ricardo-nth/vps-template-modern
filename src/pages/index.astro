---
import SiteLayout from '../layouts/SiteLayout.astro';
import { getEntry } from 'astro:content';
import Hero from '../components/Hero.astro';
import ServicesOverview from '../components/ServicesOverview.astro';
import AboutUs from '../components/AboutUs.astro';
import WhyChooseUs from '../components/WhyChooseUs.astro';
import TeamSection from '../components/TeamSection.astro';
import ContactSection from '../components/ContactSection.astro';
import { getModernImage } from '@/lib/content/imageRegistry';

const homeEntry = await getEntry('modernHome', 'default');
const homeDomEntry = await getEntry('modernHome', 'dom-care');
if (!homeEntry) {
  throw new Error('Missing content entry: modernHome/default');
}
if (!homeDomEntry) {
  throw new Error('Missing content entry: modernHome/dom-care');
}

const metadata = homeEntry.data.metadata;
const profiles = [
  { key: 'supported-living', content: homeEntry.data },
  { key: 'dom-care', content: homeDomEntry.data },
] as const;
---

<SiteLayout metadata={metadata}>
  <div data-care-profile-switcher>
    {profiles.map(({ key, content }) => (
      <div data-care-profile-panel={key} class:list={{ hidden: key !== 'supported-living' }}>
        <Hero
          heading={content.hero.heading}
          subheading={content.hero.subheading}
          profileContent={content.hero.profileContent}
          primaryCtaText={content.hero.primaryCtaText}
          primaryCtaHref={content.hero.primaryCtaHref}
          secondaryCtaText={content.hero.secondaryCtaText}
          secondaryCtaHref={content.hero.secondaryCtaHref}
          rating={content.hero.rating}
          ratingLabel={content.hero.ratingLabel}
          imageSrc={getModernImage(content.hero.imageKey)}
          imageAlt={content.hero.imageAlt}
          socialProofTitle={content.hero.socialProofTitle}
          socialProofSubtitle={content.hero.socialProofSubtitle}
          socialProofCountLabel={content.hero.socialProofCountLabel}
        />

        <ServicesOverview
          eyebrow={content.servicesOverview.eyebrow}
          heading={content.servicesOverview.heading}
          intro={content.servicesOverview.intro}
          ctaText={content.servicesOverview.ctaText}
          ctaHref={content.servicesOverview.ctaHref}
          services={content.servicesOverview.services.map(({ imageKey, ...service }) => ({
            ...service,
            imageSrc: getModernImage(imageKey),
          }))}
        />

        <AboutUs
          eyebrow={content.aboutUs.eyebrow}
          heading={content.aboutUs.heading}
          description={content.aboutUs.description}
          imageSrc={getModernImage(content.aboutUs.imageKey)}
          imageAlt={content.aboutUs.imageAlt}
          phoneLabel={content.aboutUs.phoneLabel}
          phoneHref={content.aboutUs.phoneHref}
          sectionId={content.aboutUs.sectionId}
        />

        <WhyChooseUs
          eyebrow={content.whyChooseUs.eyebrow}
          heading={content.whyChooseUs.heading}
          intro={content.whyChooseUs.intro}
          imageSrc={getModernImage(content.whyChooseUs.imageKey)}
          imageAlt={content.whyChooseUs.imageAlt}
          ctaText={content.whyChooseUs.ctaText}
          ctaHref={content.whyChooseUs.ctaHref}
          class={content.whyChooseUs.className}
          points={content.whyChooseUs.points}
          testimonial={content.whyChooseUs.testimonial}
        />

        <TeamSection
          heading={content.teamSection.heading}
          intro={content.teamSection.intro}
          members={content.teamSection.members.map(({ imageKey, ...member }) => ({
            ...member,
            image: getModernImage(imageKey),
          }))}
        />

        <ContactSection
          heading={content.contactSection.heading}
          intro={content.contactSection.intro}
          phoneLabel={content.contactSection.phoneLabel}
          phoneHref={content.contactSection.phoneHref}
          emailLabel={content.contactSection.emailLabel}
          emailHref={content.contactSection.emailHref}
          emailButtonText={content.contactSection.emailButtonText}
          address={content.contactSection.address}
          officeTitle={content.contactSection.officeTitle}
          officeDirectionsText={content.contactSection.officeDirectionsText}
          officeDirectionsHref={content.contactSection.officeDirectionsHref}
          hoursTitle={content.contactSection.hoursTitle}
          officeHours={content.contactSection.officeHours}
          hoursNote={content.contactSection.hoursNote}
        />
      </div>
    ))}
  </div>
</SiteLayout>
